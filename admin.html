<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>RWB ToolKit Admin</title>
<style>
body {
  font-family: sans-serif;
  background: #f5f5f5;
  padding: 20px;
}
h2 { margin-top: 30px; }
pre {
  background: #222;
  color: #0f0;
  padding: 10px;
  overflow-x: auto;
}
input, button, select {
  margin: 4px 0;
  padding: 5px;
}
button { cursor: pointer; }
</style>
</head>
<body>

<h1>RWB ToolKit — Панель администратора</h1>

<h2>Создать ключ</h2>
<input id="createPlan" placeholder="plan (week|month|year|test)" />
<input id="createDays" placeholder="дней (опционально)" />
<input id="createKey" placeholder="кастомный ключ (опционально)" />
<input id="createNote" placeholder="примечание (опционально)" />
<input id="createDevice" placeholder="device id (опционально)" />
<br>
<button id="btnCreate">Создать</button>
<pre id="createOut"></pre>

<h2>Продлить ключ</h2>
<input id="extendKey" placeholder="ключ" />
<input id="extendDays" placeholder="дней" />
<br>
<button id="btnExtend">Продлить</button>
<pre id="extendOut"></pre>

<h2>Статус ключа</h2>
<input id="statusKey" placeholder="ключ" />
<br>
<button id="btnActivate">Активировать</button>
<button id="btnDeactivate">Отключить</button>
<pre id="statusOut"></pre>

<h2>Привязать устройство</h2>
<input id="bindKey" placeholder="ключ" />
<input id="bindDevice" placeholder="device id" />
<br>
<button id="btnBind">Привязать</button>
<pre id="bindOut"></pre>

<h2>Инфо о ключе</h2>
<input id="infoKey" placeholder="ключ" />
<br>
<button id="btnInfo">Получить</button>
<pre id="infoOut"></pre>

<script>
function $(id) { return document.getElementById(id); }
function out(el, data) {
  el.textContent = JSON.stringify(data, null, 2);
}

async function post(path, body) {
  const r = await fetch(path, {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify(body || {})
  });
  return r.json();
}

async function get(path) {
  const r = await fetch(path);
  return r.json();
}

// create
const createPlan = $('createPlan'), createDays = $('createDays'), createKey = $('createKey'),
      createNote = $('createNote'), createDevice = $('createDevice'),
      createOut = $('createOut'), btnCreate = $('btnCreate');

btnCreate.onclick = async () => {
  const data = await post('/api/admin/create', {
    plan: createPlan.value.trim(),
    days: Number(createDays.value) || undefined,
    key: createKey.value.trim() || undefined,
    note: createNote.value.trim() || undefined,
    device: createDevice.value.trim() || undefined
  });
  out(createOut, data);
};

// extend
const extendKey = $('extendKey'), extendDays = $('extendDays'), extendOut = $('extendOut'), btnExtend = $('btnExtend');

btnExtend.onclick = async () => {
  const data = await post('/api/admin/extend', {
    key: extendKey.value.trim(),
    days: Number(extendDays.value) || undefined
  });
  out(extendOut, data);
};

// status
const statusKey = $('statusKey'), btnActivate = $('btnActivate'), btnDeactivate = $('btnDeactivate'), statusOut = $('statusOut');

btnActivate.onclick = async () => {
  const key = statusKey.value.trim();
  if (!key) return out(statusOut, { ok:false, error:'Введите ключ' });
  const data = await post('/api/admin/set-active', { key, isActive: true }); // исправлено
  out(statusOut, data);
};

btnDeactivate.onclick = async () => {
  const key = statusKey.value.trim();
  if (!key) return out(statusOut, { ok:false, error:'Введите ключ' });
  const data = await post('/api/admin/set-active', { key, isActive: false }); // исправлено
  out(statusOut, data);
};

// bind
const bindKey = $('bindKey'), bindDevice = $('bindDevice'), bindOut = $('bindOut'), btnBind = $('btnBind');

btnBind.onclick = async () => {
  const data = await post('/api/admin/bind-device', {
    key: bindKey.value.trim(),
    device: bindDevice.value.trim()
  });
  out(bindOut, data);
};

// info
const infoKey = $('infoKey'), infoOut = $('infoOut'), btnInfo = $('btnInfo');

btnInfo.onclick = async () => {
  const data = await get('/api/admin/info?key=' + encodeURIComponent(infoKey.value.trim()));
  out(infoOut, data);
};
</script>

</body>
</html>
