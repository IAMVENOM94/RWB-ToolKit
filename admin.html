<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>WB SKU Checker — Админка лицензий</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #0f1115;
      --card: #151922;
      --muted: #9aa4b2;
      --text: #e7ecf3;
      --surface: #0c1016;
      --border: #242a36;
      --accent: #2a62ff;
      --radius: 14px;
    }
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    h1 { font-size: 22px; margin: 0 0 16px; }
    h2 { font-size: 16px; margin: 0 0 12px; }
    .wrap { max-width: 1000px; margin: 24px auto; padding: 0 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; }
    .card { background: var(--card); border-radius: var(--radius); padding: 16px; border: 1px solid rgba(255,255,255,.04); box-shadow: 0 4px 16px rgba(0,0,0,.2); }
    label { display: block; color: var(--muted); margin: 10px 0 6px; font-size: 12px; letter-spacing: .2px; }
    input, select, textarea {
      width: 100%; background: var(--surface); color: var(--text);
      border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(42,98,255,.2); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btn {
      background: var(--accent); color: #fff; border: none; border-radius: 10px;
      padding: 10px 12px; cursor: pointer; font-weight: 600;
    }
    .btn.secondary { background: transparent; color: var(--text); border: 1px solid var(--border); }
    .btn:disabled { opacity: .6; cursor: default; }
    .btns { display:flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .log {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 10px; height: 160px; overflow: auto; white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    footer { margin-top: 16px; opacity: .7; font-size: 12px; }
    .note { color: var(--muted); font-size: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>WB SKU Checker — Админка лицензий</h1>
    <div class="grid">
      <section class="card">
        <h2>Создать ключ</h2>
        <label>Тариф</label>
        <select id="plan">
          <option value="week">week (7д)</option>
          <option value="month" selected>month (30д)</option>
          <option value="year">year (365д)</option>
          <option value="test">test (3д)</option>
        </select>
        <div class="row">
          <div>
            <label>Дней</label>
            <input id="days" type="number" placeholder="например, 14" />
          </div>
          <div>
            <label>DeviceID</label>
            <input id="device" type="text" placeholder="dev_xxx" />
          </div>
        </div>
        <label>Примечание</label>
        <input id="note" type="text" placeholder="комментарий" />
        <div class="btns">
          <button class="btn" id="btnCreate">Создать</button>
          <button class="btn secondary" id="btnClear">Очистить</button>
        </div>
        <div style="margin-top:10px;">
          <div class="note">Результат</div>
          <div id="createOut" class="log"></div>
        </div>
      </section>

      <section class="card">
        <h2>Продлить ключ</h2>
        <label>Ключ</label>
        <input id="extKey" type="text" placeholder="SKU..." />
        <label>Дней прибавить</label>
        <input id="extDays" type="number" value="30" />
        <div class="btns"><button class="btn" id="btnExtend">Продлить</button></div>
        <div style="margin-top:10px;"><div class="note">Результат</div><div id="extendOut" class="log"></div></div>
      </section>

      <section class="card">
        <h2>Статус ключа</h2>
        <label>Ключ</label>
        <input id="statusKey" type="text" placeholder="SKU..." />
        <div class="btns">
          <button class="btn" id="btnActivate">Активировать</button>
          <button class="btn secondary" id="btnDeactivate">Отключить</button>
        </div>
        <div style="margin-top:10px;"><div class="note">Результат</div><div id="statusOut" class="log"></div></div>
      </section>

      <section class="card">
        <h2>Привязка / Инфо</h2>
        <label>Ключ</label>
        <input id="bindKey" type="text" placeholder="SKU..." />
        <label>DeviceID</label>
        <input id="bindDevice" type="text" placeholder="dev_xxx" />
        <div class="btns">
          <button class="btn" id="btnBind">Привязать</button>
          <button class="btn secondary" id="btnInfo">Info</button>
        </div>
        <div style="margin-top:10px;"><div class="note">Результат</div><div id="bindOut" class="log"></div></div>
      </section>
    </div>
    <footer>Сервер: <span id="baseUrl"></span></footer>
  </div>

  <script>
    const BASE = location.origin;
    const $ = (id) => document.getElementById(id);
    const pretty = (obj) => JSON.stringify(obj, null, 2);
    const out = (el, data) => el.textContent = typeof data === 'string' ? data : pretty(data);
    document.getElementById('baseUrl').textContent = BASE;

    async function post(path, body) {
      const r = await fetch(BASE + path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body || {})
      });
      const t = await r.text();
      try { return JSON.parse(t); } catch { return { ok: false, raw: t }; }
    }
    async function get(path, params = {}) {
      const q = new URLSearchParams(params).toString();
      const r = await fetch(BASE + path + (q ? ('?' + q) : ''), { method: 'GET' });
      const t = await r.text();
      try { return JSON.parse(t); } catch { return { ok: false, raw: t }; }
    }

    // create
    const plan = $('plan'), days = $('days'), device = $('device'), note = $('note');
    const btnCreate = $('btnCreate'), btnClear = $('btnClear'), createOut = $('createOut');
    btnCreate.onclick = async () => {
      btnCreate.disabled = true;
      const data = await post('/api/admin/create', {
        plan: plan.value,
        days: days.value ? Number(days.value) : undefined,
        device: device.value.trim() || undefined,
        note: note.value.trim() || undefined
      });
      out(createOut, data);
      btnCreate.disabled = false;
    };
    btnClear.onclick = () => { plan.value = 'month'; days.value = ''; device.value = ''; note.value=''; createOut.textContent=''; };

    // extend
    const extKey = $('extKey'), extDays = $('extDays'), btnExtend = $('btnExtend'), extendOut = $('extendOut');
    btnExtend.onclick = async () => {
      const key = extKey.value.trim();
      const d = Number(extDays.value || '0');
      if (!key || !d) return out(extendOut, { ok:false, error:'Введите ключ и дни' });
      const data = await post('/api/admin/extend', { key, days: d });
      out(extendOut, data);
    };

    // status
    const statusKey = $('statusKey'), btnActivate = $('btnActivate'), btnDeactivate = $('btnDeactivate'), statusOut = $('statusOut');
    btnActivate.onclick = async () => {
      const key = statusKey.value.trim();
      if (!key) return out(statusOut, { ok:false, error:'Введите ключ' });
      const data = await post('/api/admin/set-active', { key, active: true });
      out(statusOut, data);
    };
    btnDeactivate.onclick = async () => {
      const key = statusKey.value.trim();
      if (!key) return out(statusOut, { ok:false, error:'Введите ключ' });
      const data = await post('/api/admin/set-active', { key, active: false });
      out(statusOut, data);
    };

    // bind/info
    const bindKey = $('bindKey'), bindDevice = $('bindDevice'), btnBind = $('btnBind'), btnInfo = $('btnInfo'), bindOut = $('bindOut');
    btnBind.onclick = async () => {
      const key = bindKey.value.trim();
      const dev = bindDevice.value.trim();
      if (!key || !dev) return out(bindOut, { ok:false, error:'Нужны ключ и device' });
      const data = await post('/api/admin/bind-device', { key, device: dev });
      out(bindOut, data);
    };
    btnInfo.onclick = async () => {
      const key = bindKey.value.trim();
      if (!key) return out(bindOut, { ok:false, error:'Введите ключ' });
      const data = await get('/api/admin/info', { key });
      out(bindOut, data);
    };
  </script>
</body>
</html>
